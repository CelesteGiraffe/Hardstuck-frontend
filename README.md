# Rocket League Training Journal

A local-first Rocket League training journal that combines:
- structured practice timers,
- skill tracking,
- training session logs,
- and automatic MMR updates from a BakkesMod plugin.

The goal is to treat Rocket League improvement like a fitness program: track training (input) and compare it to ranked results (output).

---

## Overview

This project consists of three main parts:

### 1. Local API (Node + SQLite)
- Stores all persistent data.
- Exposes simple REST endpoints for:
  - skills,
  - timer presets,
  - training sessions,
  - MMR logs.
  - aggregated skill summaries for charting (e.g., minutes per skill over a date range).
- Designed to be small and easy to understand.

### 2. Front-End UI (Svelte + TypeScript)
- Runs in the browser.
- Allows me to:
  - create and edit skills,
  - build preset training routines,
  - run timed training sessions with notes,
  - review history,
  - view charts connecting training to MMR performance.

### 3. BakkesMod Plugin (C++)
- Sends MMR snapshots to the API after matches.
- Provides accurate, automatic “weigh-in” records.
- Helps correlate training with real competitive results.

---

## Philosophy
Keep the system:
- local,
- simple,
- modular,
- and fully understandable by me.

Avoid unnecessary frameworks, generated file forests, or cloud dependencies. Everything should feel lightweight and easy to maintain.

---

## Features (Planned or Completed)

### Training Features
- Create and manage skills.
- Build timer presets with blocks (focus time, rest time, VOD review, etc.).
- Start a preset from the Home screen and let the timer guide you through each block.
- Run training sessions with a live timer and block-by-block notes.
- Log all actual durations and session notes.

### MMR Tracking
- Automatic MMR logging from BakkesMod plugin.
- Manual MMR logging if needed.
- SQLite storage for all match results.

### History export/import
- Copy or download the CSV generated by the History screen to capture sessions and MMR rows with headers that can be shared between machines.
- Paste or upload the same CSV back into the History screen to import MMR rows; the API validates each line, reports how many were imported/skipped, and keeps the database in sync.

### Preset sharing
- Generate a compact, versioned text blob for any preset so you can drop it in chat or pastebin and let friends reproduce your routine instantly.
- Import a shared string to rehydrate the preset along with every referenced skill (notes, tags, and BakkesMod favorite links are recreated per user).

### Plugin API contract
The BakkesMod plugin calls the local API to report ranked matches. The endpoint expects a single POST request per match to `/api/mmr-log`.

- **URL:** `http://localhost:4000/api/mmr-log` (adjust the port via `PORT` if you host the API elsewhere).
- **Headers:** `Content-Type: application/json`
- **Required payload fields**
  - `timestamp`: ISO 8601 string (e.g., `2025-11-13T00:00:00Z`).
  - `playlist`: non-empty string naming the ranked playlist (e.g., `Standard`, `Doubles`).
  - `mmr`: numeric MMR value after the match.
  - `gamesPlayedDiff`: numeric change in games played since the previous log (typically `1`).
  - `source`: optional string that defaults to `bakkes`.
- The endpoint validates each field and returns an HTTP 400 with a compact error message when something is missing or the wrong type. That keeps the plugin fast and predictable.

#### Example payloads
```
{
  "timestamp": "2025-11-13T03:14:00Z",
  "playlist": "Standard",
  "mmr": 2125,
  "gamesPlayedDiff": 1,
  "source": "bakkes"
}

{
  "timestamp": "2025-11-13T03:45:00Z",
  "playlist": "Doubles",
  "mmr": 2058,
  "gamesPlayedDiff": 1
}
```

Assumptions
- The API server is running locally on port 4000 (or use the `PORT` environment variable).
- The plugin can retry failed requests if it receives a 400–level response, since the error message explains what’s wrong.

### Favorites sync

- Each Bakkes user keeps a list of favorites tracked by the server in the `bakkes_favorites` SQLite table (see `api/db.js`).
- The web API exposes those favorites via `GET /api/v1/bakkes/favorites` so the plugin or UI can consume them.
- The route requires the `X-User-Id` header so the server can return the favorites belonging to that user only.
- The response is a JSON array of `{ name, code }` objects (empty if the user has no favorites yet).

### Analytics
- Time spent per skill (bar charts).
- Overall training volume over time.
- MMR trends per playlist (line charts).
- Basic comparison of training vs performance.

---

## Folder Structure

This repo includes:
- an `api/` folder for the Node + SQLite server,
- a `ui/` folder for the Svelte front-end,
- space reserved for a `bakkes_plugin/` folder containing the eventual C++ plugin code.

Each part is kept small and isolated so the project is easy to maintain.

---

## Getting Started

1. Start the API:
   - navigate to `api/`
   - install dependencies
   - run the server on localhost

2. Start the UI:
   - navigate to `ui/`
   - install dependencies
   - run the dev server in a browser

3. (Later) Enable the BakkesMod plugin to start sending MMR logs automatically.

Alternatively, run both components with one command:

```
npm start
```

If you want a convenience script that installs missing deps, starts both servers and opens the UI in your browser, use the new cross-platform helper:

```bash
npm run dev:start

Note: the helper will ensure the repo root dependencies (e.g. `concurrently`) plus `api/` and `ui/` are installed if they're missing before it starts the servers.
```

This uses `concurrently` to launch the API server and the Vite dev server together so you can test the entire stack while developing.

The UI dev server already proxies `/api` to `http://localhost:4000`, so API calls work without extra configuration.

## How to use

1. **Launch the stack**
  - Run the API (`cd api && npm start`) and keep it listening on `http://localhost:4000`.
  - Start the UI (`cd ui && npm run dev -- --host`) and open the Vite URL in your browser.

2. **Log training**
  - Create skills and presets in the UI.
  - Begin a preset from the Home screen or use the quick timer to log a focused block tied to a skill.
  - Add notes and adjust block durations if needed so the session reflects your actual work.

3. **Track performance**
  - Let the BakkesMod plugin POST to `/api/mmr-log` after matches, or use the manual form on the History screen.
  - Visit the History screen to view skill summaries and playlist-specific MMR trends.
  - The home dashboard caches presets, minutes, skill summaries, and MMR records so you see the last-known stats immediately while the UI revalidates in the background.
  - Check the setup checklist card on the home screen to confirm you have skills, presets, and recent MMR logs, and use the plugin installation link when logging is missing.
  - API health errors are surfaced right in the hero banner with a retry button so you can reconnect the local server without hunting through the console.

4. **Verify everything**
  - Run `npm test` from the repo root to execute the API Jest suite and the UI `svelte-check`/TypeScript checks at once.

## Testing

Run everything with a single command from the project root:

```
npm test
```

This runs the API Jest suite and the UI `svelte-check`/TypeScript validation together so every feature is exercised in one step. Use the per-folder commands (`npm run test` in `api/`, `npm run check` in `ui/`) when you need to focus on just one layer.

---

## License
Local personal project — no license required unless I add one later.